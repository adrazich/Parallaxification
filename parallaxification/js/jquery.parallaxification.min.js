// jquery.parallaxification.js - Parallaxification is a jQuery gallery plugin for easy parallax scrolling including infinite scrolling.
// Version: 0.6 alpha - this plugin is currently under development
// Author: Anna Drazich
// Website: http://www.initanna.com/parallaxification/
// Github: https://github.com/adrazich/parallaxification
//
// Copyright (c) 2012 Anna Drazich
// Dual licensed under the MIT and GPL licenses.
// MIT License: https://github.com/adrazich/parallaxification/blob/master/MIT-License.txt
// GPL License: https://github.com/adrazich/parallaxification/blob/master/GPL-License.txt

function CalculateSpeed(b){1E3<b&&(b=1E3);-1E3>b&&(b=-1E3);return 200*(b- -1E3)/2E3+0}
(function(b,h){b.fn.parallax=function(l){var c=_defaults=b.extend({z:null,useZSpeed:!1,direction:"horizontal",easing:"linear",useVelocity:!1,speed:500,animationSpeed:500,repeat:!1,selector:this.selector,onAnimationStart:function(){},onAnimationEnd:function(){}},l),d=viewport=null;return this.each(function(){function l(){c.onAnimationStart.call(this)}function m(){c.onAnimationEnd.call(this)}function k(){if(c.repeat&&null!==a){var e=Math.ceil(viewport.width/d.totalWidth),f=Math.ceil(viewport.width/
c.speed);if(a.number.screen<e){for(var g=0;g<e-a.number.screen;g++)j(!1);a.number.screen=e}if(a.number.side<f){for(g=0;g<f-a.number.side;g++)j(!0),j(!1);a.number.side=f}0>b(c.selector).eq(a.begin).offset().left+d.totalWidth*a.number.side&&(tmp=b(c.selector).eq(a.end).offset().left+d.totalWidth,b(c.selector).eq(a.begin).stop().css("margin-left",tmp+"px"),e=a.begin+1>b(c.selector).length-1?0:a.begin+1,a.end=a.begin,a.begin=e);b(c.selector).eq(a.end).offset().left-(d.totalWidth*(a.number.side-1)+d.totalWidth)>
viewport.width&&(tmp=b(c.selector).eq(a.begin).offset().left-d.totalWidth,b(c.selector).eq(a.end).stop().css("margin-left",tmp+"px"),e=0>a.end-1?b(c.selector).length-1:a.end-1,a.begin=a.end,a.end=e)}}function j(e){var e=!1===e?!1:!0,f=b(i).clone(!0);if(e){var e=b(c.selector).eq(a.begin),g=e.offset().left-d.totalWidth;f.css("margin-left",g+"px");f.insertBefore(e);f=a.begin-1;a.begin=0>f?0:f;a.end++}else e=b(c.selector).eq(a.end),g=e.offset().left+d.totalWidth,e.offset(),f.css("margin-left",g+"px"),
f.insertAfter(e),f=a.end+1,a.end=f>b(c.selector).length-1?b(c.selector).length-1:f}var i=this,a=null;viewport={width:b(h).width(),height:b(h).height()};d={width:b(i).width(),totalWidth:0,animating:!1,offset:0,margin:{left:parseInt(b(i).css("margin-left")),right:parseInt(b(i).css("margin-right"))}};c.useZSpeed&&(c.speed=CalculateSpeed(c.z));c.offset="vertical"==c.direction?b(i).css("margin-top"):b(i).css("margin-left");d.totalWidth=d.margin.left+d.margin.right+d.width;c.repeat&&(a={begin:0,end:0,number:{side:0,
screen:1},animate:{to:0,curr:0}},console.log("begin "+a.begin+" left "+b(c.selector).eq(a.begin).offset().left+" end "+a.end+" left "+b(c.selector).eq(a.end).offset().left),k(),console.log("begin "+a.begin+" left "+b(c.selector).eq(a.begin).offset().left+" end "+a.end+" left "+b(c.selector).eq(a.end).offset().left),j(!0),j(!1));b(h).on("resize",function(){viewport.width=b(h).width();viewport.height=b(h).height();k()});b(h).on("mousewheel",function(a,f){clearTimeout(b.data(this,"timer-"+c.selector));
b.data(this,"timer-"+c.selector,setTimeout(function(){d.animating=false;m();b(c.selector).stop(true,false)},100));var g={},g=f>0?"-=":"+=",h=1;c.useVelocity&&(h=Math.abs(f));g=c.direction=="vertical"?{marginTop:g+c.speed*h+"px"}:{marginLeft:g+c.speed*h+"px"};k();if(!d.animating){d.animating=true;l();b(c.selector).animate(g,c.animationSpeed,c.easing,function(){d.animating=false;m()})}});b(h).everyTime(250,function(){d.animating&&k()})})}})(jQuery,window,document);